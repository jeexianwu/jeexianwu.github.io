---
layout: default
title: 蓄水池抽样算法的证明
comments: true
categories: [algorithm]
---
## 蓄水池抽样算法证明
---
2012-11-1

这个题很老了，刚刚遇到一个类似的题目，不是让写怎么实现的，而是要证明结果确实是等概率，我了擦一下子忘了怎么证明了，以前竟然是把答案给背下来了，鄙视一下自己......


原题：现在有一组数，不知道这组数的总量有多少，请描述一种算法能够在这组数据中随机抽取k个数，使得每个数被取出来的概率相等。

即假如一共有N个数，那么最终结果是每个取出来的数都是以1/N的概率取出来的。

### 答案
---
据说这是在《The Art of Computer Programming》中出现的题目，虽然有这本书，但是我实在看不下去，真不知道作者怎么想到答案的，伪代码：

    Init : a reservoir with the size： k  
    for i= k+1 to N  
        M=random(1, i);  
        if( M < k)  
         SWAP the Mth value and ith value  
    end for   

描述为：先把前k个数取出来放到结果集中，然后从k+1开始遍历，每遇到一个数就以k/k+n（其中n从1开始递增）的概率把它取出来，然后再以1/k的概率从结果集中取出来一个数，最后用前者替换掉后者。

### 证明过程
---
1、文字描述：假设当前为第n个数，那么n最后留在结果集中的概率 = n被选中的概率 \* \[n后面的数没有被选中的概率 + n后面的数被选中的概率\*n没有被替换的概率\]，如果数据总数量为N，那么最终结果是每个数取出的概率都为k/N。

2、公式证明：
![](/images/algorithm/11-1/1.png)
