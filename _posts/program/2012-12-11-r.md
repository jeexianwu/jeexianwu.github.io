---
layout: default
title: R统计入门实践
categories: [program]
---

# R统计入门实践 #
-----------------

## 目录

一、统计学基础
 - [1.1.均值 中位数 众数](#1.1)
 - [1.2.极差 中程数](#1.2)
 - [1.3.基本的柱形图](#1.3)
 - [1.4.复杂柱形图](#1.4)
 - [1.5.线形图](#1.5)
 - [1.11.统计：集中趋势](#1.11)
 - [1.74.列联表χ2检验](#1.74)

二、R语言解析
 - [2.1.R参数]()
 - [2.2.基本数据结构](#2.2)

三、统计分析练习
 - [3.1.QQ聊天记录统计](#3.1)
 - [3.2.电子商务数据分析](#3.2)

一、统计学基础

<a id="1.1">&nbsp;</a>

### 1.1.均值 中位数 众数
现有一组数据：

    > n <- c(23,29,20,32,23,21,33,25)

均值(mean)是指所有数字相加求平均值：
    
    > mean(n)
    [1] 25.75

中位数(median)是指位于数组最中间的那个数，如果中间有两个数则求他们的平均值：

    > median(n)
    [1] 24

众数(mode)是指出现次数最多的数，R中没有直接求众数的函数，所以需要用一些技巧：

    > which.max(table(n))
    23 
     3 

`table(n)`可以求出n中各个数字出现的频率，再使用`which.max`求出最大的那个频率。

<a id="1.2">&nbsp;</a>

### 1.2.极差 中程数
初始化数据为：

     > n <- c(65,81,73,85,94,79,67,83,82)

极差(range)是指数组中最大的数与最小的数的差，R中可以用range函数求出最大最小值：

    > range(n)
    [1] 65 94

极差表示一组数据的紧密程度。

中程数(middle range)，指一组数据中最大数和最小数的平均值，表示这组数据的中心位置。

<a id="1.3">&nbsp;</a>

### 1.3.基本的柱形图
现在有一组学生：

    > students <- c("Lily","Lucy","Jim","Roy")

他们的考试成绩为：
    
    > score <- c(60,70,65,80)

画出基本的柱形图：

    > names(score) <- students
    > barplot(score)

![Bar Plot](/images/r/1.3.1.png)

<a id="1.4">&nbsp;</a>

### 1.4.复杂柱形图
假设我们的学生依然是：
    
    > students <- c("Lily","Lucy","Jim","Roy")

而分数变成了期中考试和期末考试：

    > middle <- c(60,70,65,80)    #期中考试
    > final <- c(70,85,95,85)     #期末考试

首先我们把数据组织成barplot的复合图需要的矩阵形式:

    > m <- matrix(nrow=2,ncol=4,data=c(1:8))
    > m
         [,1] [,2] [,3] [,4]
    [1,]    1    3    5    7
    [2,]    2    4    6    8
    > m[1,] <- middle
    > m[2,] <- final

给矩阵的行和列赋予含义：

    > score <- structure(m,.Dimnames=list(c("middle","final"),students))
    > score
           Lily Lucy Jim Roy
    middle   60   70  65  80
    final    70   85  95  85

使用barplot画出复合图,beside参数表示是否显示为纵向的柱子：
    
    > barplot(score,col=c("blue","green"),beside=T)

![Bar Plot](/images/r/1.4.1.png)

为了看起来更方便，我们为两种颜色加上legend标签，放在右上角，并且把Y轴扩展到150，防止legend放不下：

    > barplot(score,col=c("blue","green"),beside=T,legend=T,ylim=c(0,150))

![Bar Plot](/images/r/1.4.2.png)

更进一步，我们可以使用text函数在柱状图上添加每一个柱子的高度：

    > positions <- barplot(score,col=c("blue","green"),beside=T,legend=T,ylim=c(0,150))   # 获得柱状图每一个柱子的位置

    > text(positions,score+10,score)     # 第二个参数是绘图高度，第三个值是绘图内容

![Bar Plot](/images/r/1.4.3.png)

<a id="1.5">&nbsp;</a>

### 1.5.线形图
现在我们要画出某个公司在十二个月内各个月份的股价，把股价练成线形图，首先获得各个月份的名字(存储于month_names)：

    > dates <- rep(strptime("01/01/2012", format = "%d/%m/%Y"), 12) 
    > dates
     [1] "2012-01-01" "2012-01-01" "2012-01-01" "2012-01-01" "2012-01-01"
     [6] "2012-01-01" "2012-01-01" "2012-01-01" "2012-01-01" "2012-01-01"
    [11] "2012-01-01" "2012-01-01"
    > dates$mon <- dates$mon + 0:11
    > dates$mon
     [1]  0  1  2  3  4  5  6  7  8  9 10 11
    > dates
     [1] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01"
     [6] "2012-06-01" "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01"
    [11] "2012-11-01" "2012-12-01"
    > month_names <- months(dates,abbreviate=F)
    > month_names
     [1] "January"   "February"  "March"     "April"     "May"       "June"     
     [7] "July"      "August"    "September" "October"   "November"  "December" 
    > 

十二个月中，每个月的平均股价和月份数字表示分别为：

    > prices <- c(100,125,150,110,98,120,130,90,110,130,150,160)
    > m <- c(1:12)

我们使用`plot`函数画出线形图，使用`xaxt`参数指明暂时不绘出x轴的数值：

    > plot(x=m,y=prices,type="b",xaxt="n",ylim=c(0,200))

画出`x`轴的12个标尺：

    > axis(1, at=1:12, labels=F)

使用`text`的`srt`参数调整标签角度：

    > text(1:12, par("usr")[3]-10, srt = 45, adj = 1, labels = month_names, xpd = TRUE)

![Line Plot](/images/r/1.5.1.png)

<a id="1.11">&nbsp;</a>

### 1.11.统计：集中趋势
集中趋势在统计学中是指一组数据向某一中心值靠拢的程度，它反映了一组数据中心点的位置所在。





<a id="1.74">&nbsp;</a>

### 1.74.列联表χ2检验
我们现在要检验两种治疗流感的草药是不是有用，我们把志愿者分为三组，分别给他们吃：草药1（Herb1），草药2（Herb2），安慰剂（Suger Pill）。

实验结果分为得病和不得病两组：

    > sick <- c(20,30,30)
    > not_sick = c(100,110,90)

    > names(sick) <- c("herb1","herb2","suger pill")
    > names(not_sick) <- c("herb1","herb2","suger pill")

    > sick
         herb1      herb2 suger pill 
            20         30         30 

    > not_sick
         herb1      herb2 suger pill 
           100        110         90 

我们把这两组数据转换为列联表（contingency table）:

<a id="2.2">&nbsp;</a>

### 2.2.基本数据类型

### 2.2.1. Vector ###
Vector(向量)是R中最基本的数据结构，创建形式为 `data <- c(1,2,3)`.在同一个Vector中只允许同一类型的数据，比如都是整形或都是字符串，不允许混用.

### 2.2.2. Matrix ###
Matrix是特殊的向量，或者说是扩展了的向量, 创建形式为：`y <- matrix(c(1,2,3,4),nrow=2,ncol=2)`.

### 2.2.3. List ###
List在R中也是一种Vector的扩展，不同于Matrix和Vector，List可以存储不同类型的数据，即一个List中可以有整数、字符串混用. 在R中List更类似于一种key value的存储结构，可以对应Python中的Dict或者C语言中的Struct结构，创建形式：`j <- list(name="Joe", salary=55000, union=T)`, names可以省略:`jalt <- list("Joe", 55000, T)`.

### 2.2.4. Data Frame ###
Data Frame是R中最常用的结构，它类似于Matrix是二维的结构，但每一列的数据结构却可以不同，比如第一列可以使学生id(数字)，第二列可以使学生姓名(字符串).

### 2.2.5. Factor(因子) ###


<a id="3.1">&nbsp;</a>

### 3.1.QQ聊天记录统计
原题[在这里](http://www.dataanalysis.cn/alchemist/alchemist.html)。

现有一组QQ聊天记录，数据格式如下图所示：

![QQ](/images/r/3.1.1.jpg)

数据集地址：[qq.csv](http://www.dataanalysis.cn/doc/a/1/qq.csv)

题目：

1).列出QQ群中发言总量前十群友的ID和他们的发言次数:

    # 列出QQ群中发言总量前十群友的ID和他们的发言次数
    qq <- read.csv(file="http://www.dataanalysis.cn/doc/a/1/qq.csv")
    qq_count <- table(qq$id)
    qq_count <- sort(qq_count,decreasing=T)
    print(qq_count[1:10])

输出结果：
    
    7cha18        6cha4376        4cha3875         8cha083 
       1511            1238            1100             695 
    4cha698       1cha65314 acha@vip.qq.com           2cha1 
        533             440             380             354 
     5cha80        3cha4233 
        304             300 

2).列出QQ群中活跃天数最多的前十位群友的ID和他们的活跃天数（有发言则该ID当天计算一个活跃天）：

    # 列出QQ群中活跃天数最多的前十位群友的ID和他们的活跃天数
    qq$date <- format.Date(qq$time,"%Y-%m-%d")
    new_qq <- data.frame(qq$id,qq$date)
    names(new_qq) <- c("id","date")
    new_qq <- unique.data.frame(new_qq)
    # 对频率统计后的数据进行递减排序
    s <- sort(table(new_qq$id),decreasing=T)
    print(s[1:10])

输出结果：

        6cha4376        4cha3875          7cha18 acha@vip.qq.com 
            165             152             112              92 
        4cha698           2cha1         8cha083         1cha457 
             89              79              75              58 
      1cha59002          8cha08 
             53              50 

<a id="3.2">&nbsp;</a>

### 3.2.电子商务数据分析
原题目[在这里](http://www.dataanalysis.cn/alchemist/t2.html)。

现有两份电子商务系统中的真实数据。

第一份数据是3800多个商品2012年的销售记录（2012-1-1至2012-12-9），共包含三个字段：SKU编码(即库存编号)、日期、当日销售量：

![Daily Sale](/images/r/3.2.1.png)

第二份数据是以上3800多个商品的首次上架信息，包含五个字段：SKU编码、首次上架时间、对应的下架时间、上架时长、首次上架期间销售量：

![First Sale](/images/r/3.2.2.png)

### 前提条件

    1.电子商务中，通常需要向上级供货商取货才能销售，下单后至少经过一周才能到货。
    2.没有能标注清楚商品首次上架方式是“普通上架”还是“促销上架。
    3.除了首次进货的销售周期不确定，后面每次进货都尽量希望库存能保证销售30天。

### 问题

1) 从第二份数据中找出首次上架市场超过30天的商品目录

2) 从第一份数据中找出首次上架的所有商品，30天内的销售量

3) 计算下图中的各个临界值：

![Calculate](/images/r/3.2.3.png)

4) 有什么更好的办法，可以找出首日，前3日，前7日销量与30天内销量的关系？














